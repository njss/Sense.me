<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>AOIs links</title>

	<!-- Our CSV Files -->
  	<link rel="stylesheet" href="../css/dateline.css">
    <link rel="stylesheet" href="../css/style.css">  
    <link rel="stylesheet" href="../css/matcharrows.css">

    <link rel="stylesheet" type="text/css" href="../libs/jquery.gridster.css">
    <link rel="stylesheet" type="text/css" href="../css/demo_gridster.css">
    <link rel="stylesheet" type="text/css" media="all" href="../css/tabs2.css" />
	
	<link rel="stylesheet" href="../css2/bootstrap.min.css">
	<link rel="stylesheet" href="../css2/jquery-ui.css">

    <!-- <link rel="stylesheet" href="../css/svg.css">-->

    <!-- Well Known javascript libraries -->
	<script src="../libs/d3.v3.min.js"></script>
	<script src="../libs/chroma.min.js"></script>
	<script src="../libs/underscore-min.js"></script>
	<script src="../libs/queue.min.js"></script>
	<script src="../libs/lodash.js"></script>
	<script src="../libs/jquery.js" type="text/javascript"></script>
    <script src="../libs/jquery.gridster.js" type="text/javascript" charset="utf-8"></script>
	<script src="../libs/rgb.js"></script>
	<script src="../libs/clusterfck.js"></script>
	
	
	<script src="js2/colorbrewer.v1.min.js" type="text/javascript"></script>
	<script src="js2/jquery-ui.js" type="text/javascript"></script>
	<script src="js2/d3.tip.v0.6.3.js"></script>
	<script src="js2/heatmap.min.js"></script>
    <script>
		var gridster;
		var finalDataset = [];
		var filesReady = false;

		$(function(){

			var log = document.getElementById('log');

			gridster = $(".gridster ul").gridster({
			  widget_base_dimensions: [100, 55],
			  widget_margins: [5, 5],
			  autogrow_cols: true,
			  resize: {
			    enabled: true
			  },
			  draggable: {
			  handle: 'header'
			  }
			}).data('gridster');


		});

		$(function () {
		
		  $('[data-tab]').on('click', function (e) {
			$(this)
			  .addClass('active')
			  .siblings('[data-tab]')
			  .removeClass('active')
			  .siblings('[data-content=' + $(this).data('tab') + ']')
			  .addClass('active')
			  .siblings('[data-content]')
			  .removeClass('active');
			e.preventDefault();
		  });
		  
		});
	</script>
	
	
	<!-- To drive the visualizations -->
	<script src="../js/d3dateline.js"></script>
	<script src="../js/matcharrows.js"></script>	
	<script src="../js/loadcsv.js"></script>
	<script src="../js/vis.js"></script>
	
	<script>
		function itemclick(d) {
			// this function will be called when a node is clicked
			alert(d.id);
		}
		window.onload = function() {
			loadchart("svgContent", "../data/demodata.json");
		}
		
						
	</script>
	
	<!-- <link href="css2/select-multiple.css" media="screen" rel="stylesheet" type="text/css"> -->
	<link href="css2/app.css" rel="stylesheet" type="text/css"/>
	<link href="css2/arcStyle.css" rel="stylesheet">
	<link href="css2/style.css" rel="stylesheet">
</head>
<body>
	<div class="gridster">
	    <ul>
	    	<li data-row="1" data-col="1" data-sizex="16" data-sizey="5">
	    		<header>Main Toolbar</header>
	    		1
	    		
	      	</li>
	      	<li data-row="2" data-col="1" data-sizex="3" data-sizey="4">
	      		<header>File Operations</header>
	      		2
				<div id="title"><span class="large">AOIs Links</span></div>
				<div id="output">
					<select id="datasetslist">
					</select>				
				</div>
			</li>
    		<li data-row="3" data-col="1" data-sizex="3" data-sizey="7">
    			<header>Attributes</header>
				<br>
	    		<div id="experimentMenu">
					<div id="title" style="float:left">Experiments</div>
					<select id="explist" size="5" style="width:120px; margin-left:170px;" multiple="multiple">
					</select>
				</div>
				<br>
	    		<div id="experimentMenu">
					<div id="title" style="float:left">Trials</div>
					<select id="triallist" size="5" style="width:120px; margin-left:170px" multiple="multiple">
					</select>
				</div>
				<br>
	    		<div id="userMenu">
					<div id="title" style="float:left">Users</div>
					<select id="userlist" size="5" style="width:120px; margin-left:170px" multiple="multiple">
					</select>
				</div>
				<br>
				<a href='#login-box' class='login-window btn btn-default btn-md' role="button">Add to Group</a>
	      	</li>
			
			<li data-row="4" data-col="1" data-sizex="3" data-sizey="8">
    			<header>Groups</header>
	    		<br>				
				<div id="multi">
				</div>
				
	      	</li>
	      	<li data-row="2" data-col="2" data-sizex="13" data-sizey="4">
	      		<header>Group1</header>
					<div class="tabswrapper">
						<div class="tabsmain">   
							<!-- tabs -->
							<div class="tabs">
							  <a href="#" data-tab="1" class="tab active">User1</a>
							  <a href="#" data-tab="2" class="tab">User2</a>
							  <a href="#" data-tab="3" class="tab">User3</a>
							  <a href="#" data-tab="4" class="tab">User4</a>
							  <a href="#" data-tab="5" class="tab">User5</a>
							  
							  <div data-content="1" class="content active">
							  	<div id="svgContent" class="chart"></div>
							  </div>
							  <div data-content="2" class="content">User2 Content</div>
							  <div data-content="3" class="content">User3 Content</div>
							  <div data-content="4" class="content">User4 Content</div>
							  <div data-content="5" class="content">User5 Content</div>
							</div>
							<!-- /tabs -->
						</div>
					</div>
	      	</li>


			<li data-row="3" data-col="2" data-sizex="13" data-sizey="7">
				<header>AOIs Interconnections</header>
				5
				<div id="wrapper">
					<div id="chart">
						<svg>
							<defs>
							    <marker id="Triangle"
							     	viewBox="0 0 10 10" refX="0" refY="5" 
							      	markerUnits="strokeWidth"
							     	 markerWidth="4" markerHeight="3"
							      	orient="auto">
							      	<path d="M 0 0 L 10 5 L 0 10 z" />
							    </marker>
							</defs>
						</svg>
					</div>
				</div>
			</li>

			<li data-row="4" data-col="2" data-sizex="13" data-sizey="15">
    			<header>Arc</header>
	    		<br>
				<div id="arcDiv"></div>
	      	</li>
	    </ul>
  	</div>
	
	
	<div id="content">
		<div class="post">			
			<div id="login-box" class="login-popup">
			<a href="#" class="close"><img src="img/closebox.png" class="btn_close" title="Close Window" alt="Close" /></a>
			  <form method="post" class="signin" action="#">
					<fieldset class="textbox">
					<label class="groupname">
					<span>Group</span>
					<input id="groupname" name="groupname" value="" type="text" autocomplete="on" placeholder="Name">
					</label>
					
					<!-- <label class="group">
					<span>Group</span>
					<select id="dropdownGrouping" class="form-select">
					  <option selected="">Select Group</option>
					</select>
					</label> -->
													
					<button id="submitItem" class="submit button" type="button">Add</button>
													
					</fieldset>
			  </form>
			</div>
		</div>
	</div>
  	
	<footer>
		<p>test...</p>
	</footer>
	
	
	<script src="../js2/d3_arcdiagram.js"></script>	
	<script>
	
		drawArcDiagram("myData.json", "arcDiv");
		
		checkLoading();
		
		function checkLoading(){
			if(!filesReady){
				window.setTimeout(checkLoading, 100);
			} else{
				initList();
			}
		}
		
		function initList(){
			var duplicatesExperiment = [];
			
			for(var i = 0; i < finalDataset.length; i++){
				//Experiments
				if(duplicatesExperiment.length > 0 ){			
					if(!available(duplicatesExperiment, finalDataset[i].experiment)){
						duplicatesExperiment.push(finalDataset[i].experiment);
						
						d3.select("#explist")
							.append("option")			
							.attr("value", finalDataset[i].experiment)
							.on("click", function(d,i) {
								fillTrialsList(finalDataset[i].experiment);
							})
							.text(finalDataset[i].experiment);
					}
				}else{						
					duplicatesExperiment.push(finalDataset[i].experiment);
					
					d3.select("#explist")
						.append("option")			
						.attr("value", finalDataset[i].experiment)
						.on("click", function(d,i) {
							fillTrialsList(finalDataset[i].experiment);
						})
						.text(finalDataset[i].experiment);							
				}
			}
		}
		
		function fillTrialsList(value){
			var duplicatesTrials = [];
			d3.select("#triallist").selectAll("option").remove();
			d3.select("#userlist").selectAll("option").remove();
			
			for(var i = 0; i < finalDataset.length; i++){
				if(finalDataset[i].experiment === value){
					if(duplicatesTrials.length > 0 ){			
						if(!available(duplicatesTrials, finalDataset[i].trial)){
							duplicatesTrials.push(finalDataset[i].trial);
							
							d3.select("#triallist")
								.append("option")			
								.attr("value", finalDataset[i].trial)
								.on("click", function(d,i) {
									fillUsersList(finalDataset[i].experiment, finalDataset[i].trial);
								})
								.text(finalDataset[i].trial);
						}
					}else{						
						duplicatesTrials.push(finalDataset[i].trial);
						
						d3.select("#triallist")
							.append("option")			
							.attr("value", finalDataset[i].trial)
							.on("click", function(d,i) {
								fillUsersList(finalDataset[i].experiment, finalDataset[i].trial);
							})
							.text(finalDataset[i].trial);							
					}
				}
			}
		}
		
		function fillUsersList(valueExp, valueTrial){
			var duplicatesUser = [];
			d3.select("#userlist").selectAll("option").remove();
			
			for(var i = 0; i < finalDataset.length; i++){
				if(finalDataset[i].experiment === valueExp && finalDataset[i].trial === valueTrial){
					if(duplicatesUser.length > 0 ){			
						if(!available(duplicatesUser, finalDataset[i].userName)){
							duplicatesUser.push(finalDataset[i].userName);
							
							d3.select("#userlist")
								.append("option")			
								.attr("value", finalDataset[i].userName)
								.text(finalDataset[i].userName);
						}
					}else{						
						duplicatesUser.push(finalDataset[i].userName);
						
						d3.select("#userlist")
							.append("option")			
							.attr("value", finalDataset[i].userName)
							
							.text(finalDataset[i].userName);							
					}
				}
			}
		}
		
		
		function available(array, value){
			for(var i = 0; i<array.length; i++){
				if(value === array[i])
					return true;
			}
			return false;
		};
		
		function createGroup(name){	
			var outerDiv = d3.select("#multi")
				.append("div")
				.attr("data-force","30")
				.attr("id", "groupDiv-" + name)
				.attr("class", "layer title")
				.style("margin-left", "5px")
				.style("margin-right", "5px")
				.style("margin-top", "10px")
				.style("width", "37%");
			
			outerDiv.append("div")
				.attr("class", "tile__name")
				.attr("id", "groupBox" + name)
				.text("Group " + name)
				.style("font-size", "14pt");
				
			var liItem = outerDiv.append("ul")
				.attr("id", "group" + name)
				.attr("class", "tile__name");
			
			var el = document.getElementById('group' + name);
			var editableList = Sortable.create(el, { group: "omega",
				filter: '.js-remove',
			  onFilter: function (evt) {
				var el = editableList.closest(evt.item); // get dragged item
				el && el.parentNode.removeChild(el);
			  }
			});
		};
		
		$('#submitItem').click(function(){
			var name = groupname.value;
			
			createGroup(name);
			
			var selectedExp = [];
			var experiments = d3.select("#explist").selectAll("option")
			for(var i = 0; i < experiments[0].length; i++){
				if(experiments[0][i].selected){
					selectedExp.push(experiments[0][i].value);
				}
			}
			
			var selectedTrial = [];
			var trials = d3.select("#triallist").selectAll("option")
			for(var i = 0; i < trials[0].length; i++){
				if(trials[0][i].selected){
					selectedTrial.push(trials[0][i].value);
				}
			}
			
			gridster.add_widget('<li class="gs-w"> <header>Group ' + name + 
											'</header> <br> ' + selectedExp[0] + ' - ' + selectedTrial[0] +
											'<div id="groupWidget' + name + '"></li>', 16, 4, 2, 1);
			
			var newWidget = d3.select("#groupWidget" + name);
			newWidget.append("div")
				.attr("class", "tabswrapper")
				.append("div")
				.attr("class", "tabsmain")
				.append("div")
				.attr("class", "tabs");
						
			var items = d3.select("#userlist").selectAll("option");
			for(var i = 0; i < items[0].length; i++){
				if(items[0][i].selected){
					var liItem = d3.select("#group" + name);
					liItem.append("li")
						.style("color", "black")
						.append("span")
						.attr("class", "display")
						.text(items[0][i].value)
						.style("color", "black")
						.append("i")
						.attr("class", "js-remove")
						.style("color", "red")
						.style("float", "right")
						.text("X");
						
					newWidget.append("a")
						.attr("href", "#")
						.attr("data-tab", "1")
						.attr("class", "tab active")
						.text(items[0][i].value);
				}
			}
			
		});	

	</script>
	<script type="text/javascript">
	$(document).ready(function() {

		$('a.login-window').click(function() {
			
			// Getting the variable's value from a link 
			var loginBox = $(this).attr('href');

			//Fade in the Popup and add close button
			$(loginBox).fadeIn(300);
			
			//Set the center alignment padding + border
			var popMargTop = ($(loginBox).height() + 24) / 2; 
			var popMargLeft = ($(loginBox).width() + 24) / 2; 
			
			$(loginBox).css({ 
				'margin-top' : -popMargTop,
				'margin-left' : -popMargLeft
			});
			
			// Add the mask to body
			$('body').append('<div id="mask"></div>');
			$('#mask').fadeIn(300);
			
			return false;
		});
		
		// When clicking on the button close or the mask layer the popup closed 
		$(document).on('click', 'a.close, #mask', function() { 
		  $('#mask , .login-popup').fadeOut(300 , function() {
			$('#mask').remove();  
		}); 
		return false;
		});
	});
	</script>
	
	<script src="js2/Sortable.js"></script>
	<script src="js2/app.js"></script>
	
</body>
</html>
