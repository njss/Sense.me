<!DOCTYPE html>
<html>
	<head>
		<title>Data Generator</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="style.css">
		<link href="css/multi-select.css" media="screen" rel="stylesheet" type="text/css">
		<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
		<script src="http://d3js.org/d3.v3.js"></script>
	</head>
	<body>
		<h1>Sense Data Generator</h1>

		<div class="grid-container">

			<div style="margin: 0px auto;">

				<input align="middle" type="file" id="files" multiple>
			
				<br><br>

				<button id="submit-parse">Parse CSV</button>
				&nbsp;
				<button id="submit-unparse">Generate Data</button>

				<br><br>

				<i>Open the Console in your browser's inspector tools to see results.</i>
				
				<br><br>
			
				<table id="resultTable" align="center">
				</table>
				
				<br><br>				
				
				<div class="row horizontal-style" style="width:80%; margin: 0px auto;">
					<div class="col-xs-3" style="width:420px; margin: 0px auto;">
						<select id="userSelectionList" name="my-select[]" class="form-control" size="13" multiple="multiple" >
						</select>
					</div>
					
					<div class="col-xs-4" style="width:420px; margin: 0px auto;">
						<select id="experimentSelectionList" name="my-select[]" class="form-control" size="13" multiple="multiple" >
						</select>
					</div>
					
					<div class="col-xs-3" style="width:420px; margin: 0px auto;">
						<select id="trialsSelectionList" name="my-select[]" class="form-control" size="13" multiple="multiple" >
						</select>
					</div>
				</div>
				
				<br><br>
				
				
				
				</table>
			</div>
		</div>
		
	<script src="js/jquery.multi-select.js" type="text/javascript"></script>
	<script>		
		$(function()
		{			
			$('#submit-parse').click(function()
			{	
				var fileName = $('#files')[0].files[0].name;
				d3.csv(fileName, function(data) {
					console.log(data[0]);
					setTable(data);
				});
				
			});
			
			$('#userSelectionList').multiSelect({
				keepOrder: true ,
				selectableHeader: "<div class='form-control'>Selectable Users</div>",
				selectionHeader: "<div class='form-control'>Selected Users</div>",
			});
			
			$('#experimentSelectionList').multiSelect({
				keepOrder: true ,
				selectableHeader: "<div class='form-control'>Selectable Exp</div>",
				selectionHeader: "<div class='form-control'>Selected Exp</div>",
			});
			
			$('#trialsSelectionList').multiSelect({
				keepOrder: true ,
				selectableHeader: "<div class='form-control'>Selectable Trial</div>",
				selectionHeader: "<div class='form-control'>Selected Trial</div>",
			});
		});
		
		function setTable(data)
		{
			//Raw Data Table	
			var duplicates = [];
			var rawData = d3.entries(data[0]);
			var header = d3.select("#resultTable")
				.append("thead")
				.append("tr");
				
			for(var i = 0; i<rawData.length; i++){
				header.append("th")
					.text(rawData[i].key);
			}
			
			var tBody = d3.select("#resultTable")
				.append("tbody");
				
			for(var i = 0; i < data.length; i++){
				var record = d3.entries(data[i]);
				var tr = tBody.append("tr");
				for(var j = 0; j < record.length; j++){
					tr.append("td")
						.text(record[j].value);
				}
			}
			
			//User List				
			for(var i = 0; i < data.length; i++){
				var record = d3.entries(data[i]);
				
				if(duplicates.length > 0 ){			
					if(!available(duplicates, record[0].value)){
						duplicates.push(record[0].value);
						
						var listUser = d3.select("#userSelectionList")
							.append("option")
							.attr("value", record[0].value)
							.text(record[0].value);
						
					}
						
				}else{						
					duplicates.push(record[0].value);
					
					var listUser = d3.select("#userSelectionList")
							.append("option")
							.attr("value", record[0].value)
							.text(record[0].value);
							
				}
			}
			
			$('#userSelectionList').multiSelect('refresh');
				
			//Experiment List		
			var duplicates = [];			
			for(var i = 0; i < data.length; i++){
				var record = d3.entries(data[i]);
				
				if(duplicates.length > 0 ){			
					if(!available(duplicates, record[2].value)){
						duplicates.push(record[2].value);
						
						var listUser = d3.select("#experimentSelectionList")
							.append("option")
							.attr("value", record[2].value)
							.text(record[2].value);
						
					}
						
				}else{						
					duplicates.push(record[2].value);
					
					var listUser = d3.select("#experimentSelectionList")
							.append("option")
							.attr("value", record[2].value)
							.text(record[2].value);
							
				}
			}
			
			$('#experimentSelectionList').multiSelect('refresh');
			
			//Trials List		
			var duplicates = [];			
			for(var i = 0; i < data.length; i++){
				var record = d3.entries(data[i]);
				
				if(duplicates.length > 0 ){			
					if(!available(duplicates, record[3].value)){
						duplicates.push(record[3].value);
						
						var listUser = d3.select("#trialsSelectionList")
							.append("option")
							.attr("value", record[3].value)
							.text(record[3].value);
						
					}
						
				}else{						
					duplicates.push(record[3].value);
					
					var listUser = d3.select("#trialsSelectionList")
							.append("option")
							.attr("value", record[3].value)
							.text(record[3].value);
							
				}
			}
			
			$('#trialsSelectionList').multiSelect('refresh');
		};
		
		function available(array, value){
			for(var i = 0; i<array.length; i++){
				if(value === array[i])
					return true;
			}
			return false;
		};
	</script>
	</body>
</html>